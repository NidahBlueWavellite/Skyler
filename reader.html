<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Skyler — Reader</title>

<style>
/* === Publish-proof stamp === */
#publish-stamp {
  position: fixed;
  bottom: 8px;
  right: 12px;
  font-family: 'Roboto Slab', serif;
  font-size: 12px;
  opacity: 0.65;
  z-index: 9999;
  pointer-events: none;
}
</style>
</head>

<body>

<div id="publish-stamp">Last updated: loading…</div>

<script>
/* ===============================
   READ PARAMETERS
================================ */
const params = new URLSearchParams(window.location.search);

const pdfFile = params.get("file");      // required
const mode    = params.get("mode");      // "preview" | "full"
const limit   = params.get("limit");     // number (preview only)

if (!pdfFile) {
  document.body.innerHTML = "No PDF specified.";
  throw new Error("Missing PDF file");
}

/* ===============================
   BUILD PDF.js VIEWER URL
================================ */
let viewerURL =
  "viewer.html" +
  "?file=" + encodeURIComponent(pdfFile) +
  "&disableDownload=true" +
  "&disablePrint=true" +
  "&disableOpenFile=true";

/* Pass preview limit ONLY if preview mode */
if (mode === "preview" && limit) {
  viewerURL += "&previewLimit=" + encodeURIComponent(limit);
}

/* ===============================
   REDIRECT INTO PDF.js
================================ */
window.location.replace(viewerURL);

/* ===============================
   FETCH FINAL PUBLISH DATE
   (network-verifiable proof)
================================ */
fetch("https://api.github.com/repos/NidahBlueWavellite/Skyler/commits/main")
  .then(response => response.json())
  .then(data => {
    const date = new Date(data.commit.committer.date);
    document.getElementById("publish-stamp").textContent =
      "Last updated: " + date.toUTCString();
  })
  .catch(() => {
    document.getElementById("publish-stamp").textContent =
      "Last updated: unavailable";
  });
</script>

</body>
</html>
