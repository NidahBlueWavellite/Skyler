<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF Reader</title>

<style>
body {
  margin:0;
  font-family:'Roboto Slab', serif;
  background:#0d2a3a;
  color:#fff;
  display:flex;
  flex-direction:column;
  height:100vh;
}

.toolbar {
  display:flex;
  align-items:center;
  gap:10px;
  background:#082133;
  padding:8px 16px;
  position:sticky;
  top:0;
  z-index:10;
}

.toolbar button, .toolbar input {
  background-color:#eee;
  border:none;
  padding:6px 10px;
  border-radius:4px;
  cursor:pointer;
  color:#0d2a3a;
  font-weight:600;
}

.toolbar input[type="number"] {
  width:60px;
  text-align:center;
}

#pdf-frame {
  flex:1;
  border:none;
  width:100%;
}
</style>
</head>
<body>

<div class="toolbar">
  <button id="closeBtn">Close</button>
  <span>Page:</span>
  <input type="number" id="pageNumber" value="1" min="1">
  <span id="pageCount">/ ?</span>
  <button id="zoomIn">+</button>
  <button id="zoomOut">âˆ’</button>
</div>

<iframe id="pdf-frame"></iframe>

<script>
const urlParams = new URLSearchParams(window.location.search);
const pdfUrl = urlParams.get("file"); // e.g., file=pdfs/mydoc.pdf

if (!pdfUrl) {
  alert("PDF file not specified!");
  throw new Error("No PDF file provided");
}

const frame = document.getElementById("pdf-frame");
const pageInput = document.getElementById("pageNumber");
const pageCountSpan = document.getElementById("pageCount");

let scale = 1.2;

// Load PDF.js viewer iframe
frame.src = `pdfjs/viewer.html?file=${encodeURIComponent(pdfUrl)}&disableDownload=true&disablePrint=true&disableOpenFile=true`;

// Close button
document.getElementById("closeBtn").onclick = () => window.close();

// Zoom buttons: control the iframe viewer via query string reload
document.getElementById("zoomIn").onclick = () => {
  scale += 0.2;
  updateIframeScale();
};
document.getElementById("zoomOut").onclick = () => {
  if (scale > 0.6) scale -= 0.2;
  updateIframeScale();
};

function updateIframeScale() {
  // Reload iframe with scale parameter
  const src = `pdfjs/viewer.html?file=${encodeURIComponent(pdfUrl)}&disableDownload=true&disablePrint=true&disableOpenFile=true&scale=${scale}`;
  frame.src = src;
}

// Page number jump
pageInput.addEventListener("keydown", e => {
  if (e.key === "Enter") {
    const page = Number(pageInput.value);
    // Post message to viewer iframe
    frame.contentWindow.postMessage({ type: 'goToPage', page: page }, '*');
  }
});

// Listen for page change messages from PDF.js viewer
window.addEventListener('message', event => {
  if (event.data && event.data.type === 'pageChanged') {
    pageInput.value = event.data.page;
    pageCountSpan.textContent = `/ ${event.data.totalPages}`;
  }
});
</script>

</body>
</html>
